## Docker란?

도커는 컨테이너 기반의 오픈소스 가상화 플랫폼입니다.

컨테이너라 하면 배에 실는 네모난 화물 수송용 박스를 생각할 수 있는데 각각의 컨테이너 안에는 옷, 신발, 전자제품, 술, 과일등 다양한 화물을 넣을 수 있고 규격화되어 컨테이너선이나 트레일러등 다양한 운송수단으로 쉽게 옮길 수 있습니다.

서버에서 이야기하는 컨테이너도 이와 비슷한데 다양한 프로그램, 실행환경을 컨테이너로 추상화하고 동일한 인터페이스를 제공하여 프로그램의 배포 및 관리를 단순하게 해줍니다. 백엔드 프로그램, 데이터베이스 서버, 메시지 큐등 어떤 프로그램도 컨테이너로 추상화할 수 있고 조립PC, AWS, Azure, Google cloud등 어디에서든 실행할 수 있습니다.

컨테이너를 가장 잘 사용하고 있는 기업은 구글인데 2014년 발표 에 따르면 구글은 모든 서비스들이 컨테이너로 동작하고 매주 20억 개의 컨테이너를 구동 한다고 합니다.

---

### 컨테이너

컨테이너는 격리된 공간에서 프로세스가 동작하는 기술입니다. 가상화 기술의 하나지만 기존방식과는 차이가 있습니다.

기존의 가상화 방식은 주로 OS를 가상화하였습니다.

우리에게 익숙한 VMware나 VirtualBox같은 가상머신은 호스트 OS위에 게스트 OS 전체를 가상화하여 사용하는 방식입니다. 이 방식은 여러가지 OS를 가상화(리눅스에서 윈도우를 돌린다던가) 할 수 있고 비교적 사용법이 간단하지만 무겁고 느려서 운영환경에선 사용할 수 없었습니다.

이러한 상황을 개선하기 위해 CPU의 가상화 기술(HVM)을 이용한 KVMKernel-based Virtual Machine과 반가상화 Paravirtualization방식의 Xen이 등장합니다. 이러한 방식은 게스트 OS가 필요하긴 하지만 전체OS를 가상화하는 방식이 아니였기 때문에 호스트형 가상화 방식에 비해 성능이 향상되었습니다. 이러한 기술들은 OpenStack이나 AWS, Rackspace같은 클라우드 서비스에서 가상 컴퓨팅 기술의 기반이 되었습니다.

![](https://subicura.com/assets/article_images/2017-01-19-docker-guide-for-beginners-1/vm-vs-docker.png)
***가상머신과 도커***

### 이미지
도커에서 가장 중요한 개념은 컨테이너와 함께 이미지라는 개념입니다.

이미지는 컨테이너 실행에 필요한 파일과 설정값등을 포함하고 있는 것으로 상태값을 가지지 않고 변하지 않습니다(Immutable). 컨테이너는 이미지를 실행한 상태라고 볼 수 있고 추가되거나 변하는 값은 컨테이너에 저장됩니다. 같은 이미지에서 여러개의 컨테이너를 생성할 수 있고 컨테이너의 상태가 바뀌거나 컨테이너가 삭제되더라도 이미지는 변하지 않고 그대로 남아있습니다.

ubuntu이미지는 ubuntu를 실행하기 위한 모든 파일을 가지고 있고 MySQL이미지는 debian을 기반으로 MySQL을 실행하는데 필요한 파일과 실행 명령어, 포트 정보등을 가지고 있습니다. 좀 더 복잡한 예로 Gitlab 이미지는 centos를 기반으로 ruby, go, database, redis, gitlab source, nginx등을 가지고 있습니다.

말그대로 이미지는 컨테이너를 실행하기 위한 모오오오오든 정보를 가지고 있기 때문에 더 이상 의존성 파일을 컴파일하고 이것저것 설치할 필요가 없습니다. 이제 새로운 서버가 추가되면 미리 만들어 놓은 이미지를 다운받고 컨테이너를 생성만 하면 됩니다. 한 서버에 여러개의 컨테이너를 실행할 수 있고, 수십, 수백, 수천대의 서버도 문제없습니다.

---

### Dockerfile이란?

필요한 패키지를 설치하고 동작하기 위한 자신만의 설정을 담은 파일이고, 이 파일로 이미지를 생성(빌드)한다. (Makefile과 비슷)

---

### nginx

무료로 제공되는 오픈소스 웹 서버 프로그램이다. 간단하게 웹 서버는 클라이언트로 부터 요청이 발생했을 때 요청에 맞는 정적콘텐츠을 보내주는 역할을 한다. Nginx는 규모가 작은 서비스이면서 정적 데이터 처리가 많은 서비스에 적합하다고 한다.

#### 웹서버가 하는 일

커넥션을 맺는다 (클라이언트의 접속을 받아들이거나, 원치 않는 클라이언트라면 닫는다)
요청을 받는다 (HTTP 요청 메세지를 네트워크로부터 읽어들인다)
요청을 처리한다 (요청 메세지를 해석하고 행동을 취한다)
리소스에 접근한다 (메세지에서 지정한 리소스에 접근한다)
응답을 만든다 (올바른 헤더를 포함한 HTTP 응답 메세지를 생성한다)
응답을 보낸다 (응답을 클라이언트에게 돌려준다)
트랜잭션을 로그로 남긴다 (로그파일에 트랜잭션 완료에 대한 기록을 남긴다)

---

### openssl

HTTPS(Hypertext Transfer Protocol over Secure Socket Layer)는 SSL위에서 돌아가는 HTTP의 평문 전송 대신에 암호화된 통신을 하는 프로토콜이다.

이런 HTTPS를 통신을 서버에서 구현하기 위해서는 신뢰할 수 있는 상위 기업이 발급한 인증서가 필요로 한데 이런 발급 기관을 CA(Certificate authority)라고 한다. CA의 인증서를 발급받는것은 당연 무료가 아니다.

self-signed SSL 인증서는 자체적으로 발급받은 인증서이며, 로그인 및 기타 개인 계정 인증 정보를 암호화한다. 당연히 브라우저는 신뢰할 수 없다고 판단해 접속시 보안 경고가 발생한다.

self-signed SSL 인증서를 만드는 방법은 몇 가지가 있는데, 무료 오픈소스인 openssl 을 이용해 쉽게 만들수 있다.

---

### autoinex

웹 서버는 어떻게 수 많은 리소스 중 요청에 알맞은 콘텐츠를 제공할까?
일반적으로 웹 서버 파일 시스템의 특별한 한 폴더를 웹 콘텐츠를 위해 사용한다. 이 폴더를 문서루트 혹은 docroot라고 부른다. 리소스 매핑의 가장 단순한 형태는 요청 URI를 dotroot 안에 있는 파일의 이름으로 사용하는 것이다.

만약 파일이 아닌 디렉토리를 가리키는 url에 대한 요청을 받았을 때는, 요청한 url에 대응되는 디렉토리 안에서 index.html 혹은 index.htm으로 이름 붙은 파일을 찾아 그 파일의 콘텐츠를 반환한다. 이를 autoindex 라고 부른다.

---

### phpmyadmin

php를 기반으로 생성된 mySQL의 GUI로서 웹에서 실행할 수 있는 프로그램.

nginx는 웹서버이기 때문에 정적 콘텐츠밖에 다루지 못한다. 동적 페이지를 구현하기 위해서는 웹 서버 대신 동적 콘텐츠를 읽은 뒤 html로 변환시켜 웹 서버에게 다시 전달해주는 외부 프로그램(php 모듈)이 필요하다. 이런 연결 과정의 방법 혹은 규약을 정의한 것이 CGI이다.

#### php-fpm

일반 GCI 보다 빠른 처리가 가능한 FastGCI. 정리하자면,

php-fpm 을 통해 nginx와 php를 연동시켜 우리의 웹 서버가 정적 콘텐츠 뿐만 아니라 동적 콘텐츠를 다룰 수 있도록 만드는 것이다.

#### 정적콘텐츠와 동적 콘텐츠

정적 콘텐츠(static)는 변화가 없는 콘텐츠를 말합니다. 보통 HTML, CSS, JS와 같이 미리 서버에 저장해두고 서버가 요청을 받으면 그저 응답만 해주면 되는 것들로 구성되어 있습니다. 이것은 곧 어느 사용자에게든지 동일하게 결과값을 보여주게 됩니다.

동적 콘텐츠(dynamic)는 누가, 언제, 어떻게 서버에 요청했는지에 따라 결과값을 다르게 보여주는 형식입니다. 즉, 사용자가 맞춤형 콘텐츠를 제공할 수 있게 되는 것이죠. 예를 들면 유투브의 추천 영상이라던지, 이 콘텐츠를 제일 잘 활용하는 웹 서비스는 넷플릭스입니다.

웹 초기 시절에는 정적 콘텐츠만 사용되었습니다. 동적 콘텐츠를 사용하기에는 서버 성능이나 인터넷 속도가 따라주지 못했기 때문입니다. 하지만 현재는 다 구현이 가능한 세상에 살고 있습니다. 좋은 세상이죠!

요새는 대부분의 웹 서비스가 정적, 동적 콘텐츠를 모두 활용하는 정적 + 동적 콘텐츠를 사용합니다. 베너 광고나 카테고리 등 모두가 볼 수 있어야 하는 콘텐츠는 정적으로 두고, 마이페이지나 장바구니 등 사용자 맞춤형 정보를 제공해야 할 때는 동적 콘텐츠를 활용합니다. 예로 실시간 위치정보 기반 날씨 제공 어플리케이션도 정적 + 동적 콘텐츠의 대표입니다. 사실 그렇게 따지면 완전한 동적 콘텐츠의 웹 서비스는 없고 모두가 정적 + 동적 콘텐츠를 활용합니다. 우리도 정적 + 동적 콘텐츠를 적절히 활용해 멋있는 웹사이트를 만들어 봅시다.

---

### Mysql

ft_server 과제에서는 mysql을 설치하라고하지만, 데비안 버스터에서는 mariaDB만을 지원한다. mariaDB도 mysql을 기반으로 만들어졌기때문에 mysql 명령어와 완전히 호환된다.
php-mysql은 php에서 mysql에 접근할 수 있게 해주는 모듈이다.
php-mbstring은 2바이트 확장 문자를 읽을 수 있도록 해주는 모듈이다.